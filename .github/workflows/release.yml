name: Release

on:
    push:
        branches:
            - main

concurrency: ${{ github.workflow }}-${{ github.ref }}

env:
    HUSKY: 0

permissions:
    pull-requests: write
    contents: write

jobs:
    release:
        name: Release
        runs-on: ubuntu-latest
        outputs:
            hasChangeset: ${{ steps.changesets.outputs.hasChangeset }}
            published: ${{ steps.changesets.outputs.published }}
        steps:
            - name: Checkout Repo
              uses: actions/checkout@v5

            - uses: ./.github/actions/ci-setup

            - name: Create Release Pull Request
              id: changesets
              uses: changesets/action@v1
              with:
                  publish: pnpm changeset tag
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Log Has Changeset
              run: echo "hasChangeset ${{ steps.changesets.outputs.hasChangeset }}"
            - name: Log Has Published
              run: echo "published ${{ steps.changesets.outputs.published }}"

    publish-check:
        needs: release
        runs-on: ubuntu-latest
        steps:
            - name: Log Has Changeset
              run: echo "hasChangeset ${{ needs.release.outputs.hasChangeset }}"
            - name: Log Has Published
              run: echo "published ${{ needs.release.outputs.published }}"

    # publish:
    #     name: Publish
    #     runs-on: ubuntu-latest
    #     needs: release
    #     if: needs.release.outputs.published == 'true'
    #     steps:
    #         - name: Checkout Repo
    #           uses: actions/checkout@v5
    #         - name: Deploy ðŸš€
    #           uses: JamesIves/github-pages-deploy-action@v4
    #           with:
    #               folder: .
    #               branch: prod
